<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
	<head>
		<title>i3 Migration Guide - Cookie Engineer's Web Log</title>

		<!-- Meta -->
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=2, user-scalable=yes">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="creator" content="Cookie Engineer">
		<meta name="description" content="i3 Migration Guide">
		<meta name="keywords" content="linux, desktop">
		<meta name="generator" content="Hands of Cookie Engineer with some beer and VIM night coding sessions">
		<meta name="robots" content="index, follow">
		<link rel="alternate" type="application/rss+xml" href="../feed.xml">

		<!-- Social Meta -->
		<meta name="og:image" itemprop="image" content="https://cookie.engineer/design/cookiengineer.png">
		<meta name="og:title" content="i3 Migration Guide - Cookie Engineer's Web Log">
		<meta name="og:description" content="i3 Migration Guide">
		<meta name="og:site_name" content="Cookie Engineer's Web Log">
		<meta name="og:type" content="article">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:domain" content="cookie.engineer">
		<meta name="twitter:title" property="og:title" itemprop="name" content="i3 Migration Guide - Cookie Engineer's Web Log">
		<meta name="twitter:description" property="og:description" itemprop="description" content="i3 Migration Guide">

		<!-- Website Content -->
		<link rel="stylesheet" href="../../design/fontello.css">
		<link rel="stylesheet" href="../../design/layout.css">

		<!-- Website Design -->
		<link rel="stylesheet" href="../../design/weblog/weblog.css">

		<!-- Website Functionality -->
		<link rel="stylesheet" href="../../design/menu.css">
		<script src="../../design/menu.js"></script>

		<!-- Magic: Copy/Paste/Save -->
		<link rel="stylesheet" href="../../design/copypaste.css">
		<script src="../../design/copypaste.js"></script>
		<link rel="stylesheet" href="../../design/save.css">
		<script src="../../design/save.js"></script>

		<!-- Magic: Highlight -->
		<link rel="stylesheet" href="../../design/weblog/highlight.css">
		<script src="../../design/weblog/highlight.js"></script>
	</head>
	<body>
		<header>
			<aside id="menu" class="visible">
				<button id="menu-button"><i></i></button>
				<!-- TBD -->
				<a class="icon-section" href="../index.html">Web Log</a>
				<a class="icon-section" href="../../index.html">Portfolio</a>
			</aside>
		</header>
		<section id="weblog">
			<h1>i3 Migration Guide</h1>
			<article>
				<p>Today I decided to ditch GNOME.</p>
<p>
	I know, I know, you probably expect yet another rage post about
	why GNOME is shit, and why MATE is better and other opinionated
	raging comments - but nope, I'm not gonna do that.
</p>
<p>
	In my case a minor update occured to 3.38.1, which led to 
	 <code>mozjs</code>
	not being able to run without a segfault on my laptop anymore.
</p>
<p>
	Turns out, pretty much everything in the GNOME ecocystem depends
	on 
	 <code>gjs</code>
	 to function properly, so not even GDM was able to run
	without a segfault.
</p>
<h2>Tiling Window Manager(s)</h2>
<p>
	So, as I've maintained my own GNOME shell extension for a while
	to get a somewhat tiling window manager functionality, I thought
	I give another window manager a try again.
</p>
<p>
	Back in the days before even XFCE or LXDE were cool, I was using
	openbox and fluxbox for a long time, because I never liked KDE's
	approach to being a Windows look and feel and GNOME wasn't ready
	at the time.
</p>
<p>
	Eversince GNOME 3 came out around 2008 I switched to it, and got
	stuck with it for the sake of simplicity. First as an apt shadow
	on Debian and Ubuntu - and later as an Arch user.
</p>
<p>
	Nonetheless I decided to try out 
	 <a class="icon-website" href="https://i3wm.org">i3wm</a> 
	, because
	I tried it out for a short period of time when it came out but
	ditched it due to customization troubles and I thought it would
	be fair to give it another try. This time for real.
</p>
<h2>i3 WM Installation</h2>
<p>
	It's best to install i3 along with 
	 <code>dmenu</code>
	 and 
	 <code>i3status</code>
	. If you
	use a laptop display that has a configurable brightness, I highly
	recommend to install 
	 <code>brightnessctl</code>
	, too.
</p>
<p>
	Also, if you don't want to deal with shitty configuration files
	for networking and want to stay with 
	 <code>network-manager</code>
	, you should
	install the 
	 <code>network-manager-applet</code>
	, too.
</p>
<pre class="bash">
sudo pacman -S i3-wm i3status dmenu brightnessctl network-manager-applet;
</pre>
<h3>Xorg Configuration</h3>
<p>
	In order to use i3, you'll need a couple of things. As i3 is not
	a Desktop Environment and only a window manager, you'll have to
	configure X11 (Xorg) first in order to use it with multiple screens.
</p>
<p>
	First, you need to get the details of your connected monitors by
	using the 
	 <code>xrandr</code>
	 tool. The output will show all connected displays
	and their supported resolutions whereas by default they'll use the
	maximum resolution available.
</p>
<p>
	Xorg is using the 
	 <code>width x height + offset_left + offset_top</code>
	 syntax.
</p>
<p>
	If the monitors are setup incorrectly, all monitors appear with a 
	 <code>...+0+0</code>
	 output.
</p>
<p>If the monitors are setup correctly, they appear all with a different offset like in the example.</p>
<pre class="bash">
$ xrandr
(...)
HDMI1 connected 1920x1080+0+0 (normal left inverted right x axis y axis) 540mm x 300mm
(...)
HDMI2 connected 1920x1080+1920+0 (normal left inverted right x axis y axis) 540mm x 300mm
(...)
HDMI3 connected 1920x1080+3840+0 (normal left inverted right x axis y axis) 540mm x 300mm
</pre>
<p>
	In my case the monitors are connected next to each other in a horizontal
	line, from left to right. The 
	 <code>/etc/X11/xorg.conf.d/10-monitors.conf</code>
	file therefore looks like this
	:
</p>
<pre class="bash">
Section "Monitor"
	Identifier "HDMI1"
	Option "Primary" "true"
EndSection

Section "Monitor"
	Identifier "HDMI2"
	Option "LeftOf" "HDMI3"
	Option "RightOf" "HDMI1"
EndSection

Section "Monitor"
	Identifier "HDMI3"
	Option "RightOf" "HDMI2"
EndSection
</pre>
<h3>i3 Configuration</h3>
<p>The default setup of i3 is pretty straight-forward as a base.</p>
<p>
	The first time you start an i3 session, it will ask you to create a config
	file with the defaults and the file will be located at 
	 <code>~/.config/i3/config</code>
	.
	Its also important to note that my config uses 
	 <code>DejaVu Sans Mono</code>
	 as a
	font in order to have emojis in the 
	 <code>i3status</code>
	 bar available.
</p>
<p>
	Most keyboards are different, but in my case I wanted the same integration
	with the 
	 <code>Windows</code>
	 key that I had before, so I chose to use the 
	 <code>Mod4</code>
	 key.
</p>
<p>
	Most Function (Fn) keys are prefixed with 
	 <code>XF86</code>
	 and you can detect them
	by running 
	 <code>xev</code>
	 and pressing the keys on the keyboard.
</p>
<p>
	In my case, the setup looks like this
	:
</p>
<ul>
	<li>Use the <code>Windows</code> key as Modifier.</li>
	<li>Integration with <code>pulseaudio</code> ( <code>pactl</code> ).</li>
	<li>Integration with <code>brightnessctl</code> .</li>
	<li>Integration with <code>networkmanager</code> ( <code>nm-applet</code> ) that appears in the systray.</li>
	<li>Change the key refresh rate to <code>250ms</code> delay and <code>50 keys/second</code> afterwards.</li>
	<li>Bind <code>[Win]+[D]</code> to open <code>dmenu</code> to search for a Desktop Application.</li>
	<li>Bind <code>[Win]+[Q]</code> to close an application window.</li>
	<li>Bind <code>[Win]+[Enter]</code> to open a Kitty terminal window.</li>
	<li>Everything else is pretty much defaulted key bindings.</li>
</ul>
<pre class="config">
set $mod Mod4

default_border pixel 2
hide_edge_borders smart

font pango:DejaVu Sans Mono 12

exec --no-startup-id nm-applet
exec --no-startup-id xset r rate 250 50

set $refresh_i3status killall -SIGUSR1 i3status

bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10% && $refresh_i3status
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10% && $refresh_i3status
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle && $refresh_i3status
bindsym XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle && $refresh_i3status
bindsym XF86MonBrightnessUp exec --no-startup-id brightnessctl set "2%+"
bindsym XF86MonBrightnessDown exec --no-startup-id brightnessctl set "2%-"

floating_modifier $mod

bindsym $mod+Return exec kitty
bindsym $mod+q kill
bindsym $mod+d exec --no-startup-id i3-dmenu-desktop

bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

bindsym $mod+h split h
bindsym $mod+v split v
bindsym $mod+f fullscreen toggle

bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle

set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10

bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10

bindsym $mod+Shift+c reload
bindsym $mod+Shift+r restart
bindsym $mod+Shift+Escape exec "i3-nagbar -t warning -m 'Exit i3?' -B 'Yes, exit nao.' 'i3-msg exit'"

mode "resize" {

	bindsym Left resize shrink width 10 px or 10 ppt
	bindsym Down resize grow height 10 px or 10 ppt
	bindsym Up resize shrink height 10 px or 10 ppt
	bindsym Right resize grow width 10 px or 10 ppt

	bindsym Escape mode "default"
	bindsym $mod+r mode "default"

}

bindsym $mod+r mode "resize"

bar {
	status_command i3status
}
</pre>
<h3>i3status Configuration</h3>
<p>
	The 
	 <code>i3status</code>
	 bar is pretty straight-forward to configure.
</p>
<p>
	Its configuration is based on the idea of either external
	programs that are regularly executed, or via its core plugins
	that include a subset of features for common integrations.
</p>
<p>
	Its modules are made with the underlying idea to reuse
	them as easy as possible, so e.g. the timezones can be
	integrated multiple times as well as the wireless/ethernet
	modules.
</p>
<p>
	The 
	 <code>order</code>
	 string is generated by calling the modules
	from left to right in order to render the status bar.
</p>
<p>
	What I haven't figured out so far is how to integrate the
	 <code>pulse:alsa_input.pci-...analog-stereo</code>
	 interface's
	microphone state.
</p>
<p>
	It seems to be not as easy to integrate mixers and ports,
	and the 
	 <code>volume</code>
	 module seems to assume to rely on the
	 <code>master</code>
	 mixer device.
</p>
<p>
	As my config file is used among different systems, the
	identifier for the network interfaces are also different.
</p>
<p>
	For that case it's possible to use the 
	 <code>_first_</code>
	 placeholder
	as an interface name, and it will automatically select the
	first available interface that matches the interface type.
</p>
<p>
	The 
	 <code>cpu_temperature</code>
	 module is depending on the 
	 <code>temp1_input</code>
	file in 
	 <code>/sys/devices/platform/coretemp.X/hwmon/hwmon*/</code>
	and the paths might vary depending on CPU here (whereas the
	X is the cpu core id).
</p>
<pre class="config">
general {
	output_format = "i3bar"
	colors = true
	interval = 10
}

order += "wireless _first_"
order += "ethernet _first_"
order += "battery 0"
order += "cpu_temperature 0"
order += "volume master"
order += "memory"
order += "tztime local"
order += "tztime berlin"

wireless _first_ {
	format_up = "📡%quality at %essid, %bitrate"
	format_down = "📡 down"
}

ethernet _first_ {
	format_up = "🖥️ %speed"
	format_down = "🖥️ down"
}

battery 0 {
	format = "%status %percentage %remaining %emptytime"
	format_down = "No battery"
	status_chr = "⚡"
	status_bat = "🔋"
	status_unk = "❓"
	status_full = "☢️"
	path = "/sys/class/power_supply/BAT%d/uevent"
	low_threshold = 10
}

cpu_temperature 0 {
	format = "🌡️ %degrees°C"
	path = "/sys/devices/platform/coretemp.0/hwmon/hwmon4/temp1_input"
}

volume master {
	format = "🔊 %volume"
	format_muted = "🔇"
	device = "pulse:0"
}

memory {
	format = "%used"
	threshold_degraded = "10%"
	format_degraded = "MEMORY: %free"
}

tztime local {
	format = "%Y-%m-%d %H:%M:%S"
}

tztime berlin {
	format = "%Y-%m-%d %H:%M:%S %Z"
	timezone = "Europe/Berlin"
	hide_if_equals_localtime = true
}
</pre>
<h3>Cursors, Icons, and Themes</h3>
<p>
	The cursor theme for Xorg is located in 
	 <code>/usr/share/icons/default</code>
	,
	but it sometimes isn't applied correctly. A quick fix here is to
	create a symbolic link inside your home folder to it
	:
</p>
<pre class="bash">
mkdir -p $HOME/.icons/default;
ln -s /usr/share/icons/default/index.theme $HOME/.icons/default/index.theme;
</pre>
<p>
	If you want to change the GTK and icon themes for GTK-based applications,
	I would recommend to use the 
	 <code>lxappearance</code>
	 tool. It allows to select all
	themes, color schemes, fonts, cursors and other Accessibility-related
	settings - and it does not have any dependencies.
</p>
<p> <img src="/weblog/articles/i3-migration-guide/lxappearance.png" alt="lxappearance"> </p>
<p>
	After 
	 <code>lxappearance</code>
	 has saved the Theme settings, it's creating
	the GTK settings file located at 
	 <code>~/.gtkrc-2.0</code>
	.
</p>
<pre class="config">
gtk-theme-name="Arc-Dark"
gtk-icon-theme-name="Numix"
gtk-font-name="Cantarell 12"
gtk-cursor-theme-name="Breeze"
gtk-cursor-theme-size=0
gtk-toolbar-style=GTK_TOOLBAR_BOTH
gtk-toolbar-icon-size=GTK_ICON_SIZE_LARGE_TOOLBAR
gtk-button-images=1
gtk-menu-images=1
gtk-enable-event-sounds=1
gtk-enable-input-feedback-sounds=1
gtk-xft-antialias=1
gtk-xft-hinting=1
gtk-xft-hintstyle="hintfull"
</pre>
<h3>Other Software</h3>
<p>
	As above setup isn't really a complete Desktop Environment,
	I would recommend some other software due to better integrations
	with common tasks.
</p>
<ul>
	<li><code>celluloid</code> as a Media Player.</li>
	<li><code>file-roller</code> as an Archive tool.</li>
	<li><code>nemo</code> as a File Manager, as it is a fork of nautilus that doesn't need gsettings or dconf.</li>
	<li><code>gpicview-gtk3</code> as an Image Viewer.</li>
</ul>
<p>
	Rather than that I am still using 
	 <code>authenticator</code>
	 and 
	 <code>gnome-keyring</code>
	for daily integrations with Web Browsers and 2FA one time passwords.
</p>
			</article>
		</section>
		<footer>
			<p>Made with 💔 in Heidelberg, Germany. All rights (and jokes) reserved under European Law.</p>
		</footer>
		<dialog id="save">
			<article>
				<h3>Download Website <button id="save-close" title="Close Dialog">X</button></h3>
				<p>
					Usually, a Web Browser's <q>Save</q> functionality is severly broken
					and it auto-formats and auto-craps up all the HTML, CSS and JS.
					<br><br>
					This website includes Print Stylesheets, so you can also print it out
					by using <q>[Ctrl]+[P]</q> or the print feature of your Web Browser.
					<br><br>
					This website's source code is Open Source and can be downloaded from
					either of these repositories:
					<br><br>
					<a class="icon-github" href="https://github.com/cookiengineer/cookie.engineer" target="_blank">GitHub</a>
					or
					<a class="icon-gitlab" href="https://gitlab.com/cookiengineer/cookie.engineer" target="_blank">GitLab</a>
				</p>
			</article>
		</dialog>
		<script>
		if (typeof hljs !== 'undefined') {

			let codes = Array.from(document.querySelectorAll('pre[class]'));
			if (codes.length > 0) {

				codes.forEach((code) => {

					let lang = code.className || null;
					if (lang === 'javascript') {

						setTimeout(() => {

							Array.from(code.querySelectorAll('span.hljs-built_in')).forEach((node) => {

									let text = node.innerHTML || '';
									if (text === 'console') {
										node.className += ' hljs-console';
									}

							});

							Array.from(code.querySelectorAll('span.hljs-keyword')).forEach((node) => {

								let text = node.innerHTML || '';
								if (text === 'let') {
									node.className += ' hljs-let';
								} else if (text === 'new') {
									node.className += ' hljs-new';
								} else if (text === 'function') {
									node.className += ' hljs-function';
								}

							});

							Array.from(code.querySelectorAll('span.hljs-literal')).forEach((node) => {

								let text = node.innerHTML || '';
								if (text === 'null') {
									node.className += ' hljs-null';
								}

							});

						}, 500);

					}

					hljs.highlightBlock(code);

				});

			}

		}
		</script>
	</body>
</html>
